<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - AMS</title>
    <link rel="stylesheet" href="css/dashboard.css?v=hci2026" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      .theme-toggle {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #764ba2;
        margin-left: 18px;
        transition: color 0.3s;
      }
      .theme-toggle:focus {
        outline: 2px solid #764ba2;
      }
      .dark-mode .theme-toggle {
        color: #ffd200;
      }
    </style>
  </head>
  <body>
    <!-- Loading Spinner -->
    <div id="spinnerOverlay" class="spinner-overlay">
      <div class="spinner"></div>
    </div>

    <nav class="navbar">
      <div style="display: flex; align-items: center; gap: 15px">
        <div class="hamburger" onclick="toggleSidebar()">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <div class="nav-brand">üéì AMS - Admin</div>
      </div>
      <div class="nav-user">
        <span id="userName"></span>
        <button
          onclick="showChangePasswordModal()"
          class="btn-settings"
          title="Change Password"
        >
          üîí
        </button>
        <button onclick="logout()" class="btn-logout">Logout</button>
        <button
          class="theme-toggle"
          id="themeToggle"
          title="Toggle light/dark mode"
        >
          <i class="fa-regular fa-moon" id="themeIcon"></i>
        </button>
      </div>
    </nav>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>üîê Change Password</h3>
          <button class="modal-close" onclick="closeChangePasswordModal()">
            &times;
          </button>
        </div>
        <form id="changePasswordForm" onsubmit="handleChangePassword(event)">
          <div class="form-group">
            <label>Current Password *</label>
            <input
              type="password"
              id="currentPassword"
              required
              placeholder="Enter current password"
            />
          </div>
          <div class="form-group">
            <label>New Password *</label>
            <input
              type="password"
              id="newPassword"
              required
              minlength="6"
              placeholder="Enter new password (min 6 chars)"
            />
          </div>
          <div class="form-group">
            <label>Confirm New Password *</label>
            <input
              type="password"
              id="confirmPassword"
              required
              placeholder="Confirm new password"
            />
          </div>
          <div class="form-actions">
            <button
              type="button"
              class="btn-secondary"
              onclick="closeChangePasswordModal()"
            >
              Cancel
            </button>
            <button type="submit" class="btn-primary">üíæ Save Password</button>
          </div>
        </form>
      </div>
    </div>

    <div class="dashboard-container">
      <div class="sidebar">
        <ul class="menu">
          <li class="active" onclick="showSection('users')">üë• Users</li>
          <li onclick="showSection('courses')">üìö Courses</li>
          <li onclick="showSection('sections')">üè´ Sections</li>
          <li onclick="showSection('sessions')">üìÖ Sessions</li>
          <li onclick="showSection('assign')">ÔøΩ‚Äçüè´ Teacher Assignments</li>
          <li onclick="showSection('enrollments')">üéì Student Enrollments</li>
          <li onclick="showSection('attendance')">üìã Attendance Records</li>
          <li onclick="showSection('timetable')">üïê Timetable</li>
          <li onclick="showSection('reports')">üìä Reports</li>
        </ul>
      </div>

      <div class="main-content">
        <!-- Users Section -->
        <div id="users" class="content-section active">
          <div class="section-header">
            <h2>User Management</h2>
            <button class="btn-primary" onclick="showAddUserForm()">
              + Add User
            </button>
          </div>

          <div id="addUserForm" class="form-card" style="display: none">
            <h3>Create New User</h3>
            <form id="createUserForm">
              <div class="form-row">
                <div class="form-group">
                  <label>Username *</label>
                  <input type="text" name="username" required />
                </div>
                <div class="form-group">
                  <label>Password *</label>
                  <div style="position: relative">
                    <input
                      type="password"
                      name="password"
                      id="userPassword"
                      required
                    />
                    <button
                      type="button"
                      onclick="togglePasswordVisibility()"
                      style="
                        position: absolute;
                        right: 10px;
                        top: 50%;
                        transform: translateY(-50%);
                        background: none;
                        border: none;
                        cursor: pointer;
                        font-size: 18px;
                      "
                      title="Toggle password visibility"
                    >
                      üëÅÔ∏è
                    </button>
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Full Name *</label>
                  <input type="text" name="fullName" required />
                </div>
                <div class="form-group">
                  <label>Email *</label>
                  <input type="email" name="email" required />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Role *</label>
                  <select
                    name="role"
                    id="userRole"
                    onchange="toggleRoleFields()"
                    required
                  >
                    <option value="">Select Role</option>
                    <option value="Admin">Admin</option>
                    <option value="Teacher">Teacher</option>
                    <option value="Student">Student</option>
                  </select>
                </div>
              </div>
              <div id="teacherFields" style="display: none">
                <div class="form-row">
                  <div class="form-group">
                    <label>Department</label>
                    <input
                      type="text"
                      name="department"
                      placeholder="e.g., CS"
                    />
                  </div>
                  <div class="form-group">
                    <p style="color: #666; font-size: 14px; margin: 0">
                      <i class="fas fa-info-circle"></i> Employee ID will be
                      auto-generated (Format: YYYY-DEPT-XXX, e.g., 2025-CS-101)
                    </p>
                  </div>
                </div>
              </div>
              <div id="studentFields" style="display: none">
                <div class="form-row">
                  <div class="form-group">
                    <label>Department</label>
                    <input
                      type="text"
                      name="department"
                      placeholder="e.g., CS"
                    />
                  </div>
                  <div class="form-group">
                    <label>Section</label>
                    <select name="sectionId" id="sectionSelect">
                      <option value="">Select Section</option>
                    </select>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <p style="color: #666; font-size: 14px; margin: 0">
                      <i class="fas fa-info-circle"></i> Roll Number will be
                      auto-generated (Format: YYYY-DEPT-XXX, e.g., 2025-CS-720)
                    </p>
                  </div>
                </div>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn-primary">Create User</button>
                <button
                  type="button"
                  class="btn-secondary"
                  onclick="hideAddUserForm()"
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>

          <div class="table-container">
            <div class="search-bar">
              <input
                type="text"
                id="searchUsers"
                placeholder="üîç Search users..."
              />
              <select id="filterRole">
                <option value="">All Roles</option>
                <option value="Admin">Admin</option>
                <option value="Teacher">Teacher</option>
                <option value="Student">Student</option>
              </select>
            </div>
            <table id="usersTable">
              <thead>
                <tr>
                  <th style="width: 5%">ID</th>
                  <th style="width: 12%">Username</th>
                  <th style="width: 15%">Full Name</th>
                  <th style="width: 22%">Email</th>
                  <th style="width: 10%">Role</th>
                  <th style="width: 10%">Created</th>
                  <th style="width: 26%">Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Courses Section -->
        <div id="courses" class="content-section">
          <div class="section-header">
            <h2>Course Management</h2>
            <button class="btn-primary" onclick="showAddCourseForm()">
              + Add Course
            </button>
          </div>

          <div id="addCourseForm" class="form-card" style="display: none">
            <h3>Create New Course</h3>
            <form id="createCourseForm">
              <div class="form-row">
                <div class="form-group">
                  <label>Course Code *</label>
                  <input type="text" name="courseCode" required />
                </div>
                <div class="form-group">
                  <label>Course Name *</label>
                  <input type="text" name="courseName" required />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Credit Hours *</label>
                  <input type="number" name="creditHours" required />
                </div>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn-primary">Create Course</button>
                <button
                  type="button"
                  class="btn-secondary"
                  onclick="hideAddCourseForm()"
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>

          <div class="table-container">
            <div class="search-bar">
              <input
                type="text"
                id="searchCourses"
                placeholder="üîç Search courses..."
                onkeyup="filterCourses()"
              />
              <select
                id="filterCourseCH"
                onchange="filterCourses()"
                style="
                  margin-left: 10px;
                  padding: 10px;
                  border-radius: 5px;
                  border: 1px solid #ddd;
                  font-size: 14px;
                  min-width: 150px;
                "
              >
                <option value="">All Credit Hours</option>
                <option value="1">1 CH</option>
                <option value="2">2 CH</option>
                <option value="3">3 CH</option>
                <option value="4">4 CH</option>
              </select>
            </div>
            <table id="coursesTable">
              <thead>
                <tr>
                  <th>Code</th>
                  <th>Name</th>
                  <th>CH</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Sections Section -->
        <div id="sections" class="content-section">
          <div class="section-header">
            <h2>Section Management</h2>
            <button class="btn-primary" onclick="showAddSectionForm()">
              + Add Section
            </button>
          </div>

          <div id="addSectionForm" class="form-card" style="display: none">
            <h3>Create New Section</h3>
            <form id="createSectionForm">
              <div class="form-row">
                <div class="form-group">
                  <label>Section Name *</label>
                  <input type="text" name="sectionName" required />
                </div>
                <div class="form-group">
                  <label>Session</label>
                  <select name="sessionId" id="sessionSelect">
                    <option value="">Select Session</option>
                  </select>
                </div>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn-primary">
                  Create Section
                </button>
                <button
                  type="button"
                  class="btn-secondary"
                  onclick="hideAddSectionForm()"
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>

          <div class="table-container">
            <div class="search-bar">
              <input
                type="text"
                id="searchSections"
                placeholder="üîç Search sections..."
                onkeyup="filterSections()"
              />
              <select
                id="filterSectionSession"
                onchange="filterSections()"
                style="
                  margin-left: 10px;
                  padding: 10px;
                  border-radius: 5px;
                  border: 1px solid #ddd;
                  font-size: 14px;
                  min-width: 150px;
                "
              >
                <option value="">All Sessions</option>
              </select>
            </div>
            <table id="sectionsTable">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Section Name</th>
                  <th>Session</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Sessions Section -->
        <div id="sessions" class="content-section">
          <div class="section-header">
            <h2>Session Management</h2>
            <button class="btn-primary" onclick="showAddSessionForm()">
              + Add Session
            </button>
          </div>

          <div id="addSessionForm" class="form-card" style="display: none">
            <h3>Create New Session</h3>
            <form id="createSessionForm">
              <div class="form-group">
                <label>Session Name *</label>
                <input
                  type="text"
                  name="sessionName"
                  required
                  placeholder="e.g., Spring 2026"
                />
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Start Date *</label>
                  <input type="date" name="startDate" required />
                </div>
                <div class="form-group">
                  <label>End Date *</label>
                  <input type="date" name="endDate" required />
                </div>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn-primary">
                  Create Session
                </button>
                <button
                  type="button"
                  class="btn-secondary"
                  onclick="hideAddSessionForm()"
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>

          <div class="table-container">
            <div class="search-bar">
              <input
                type="text"
                id="searchSessions"
                placeholder="üîç Search sessions..."
                onkeyup="filterSessions()"
              />
            </div>
            <table id="sessionsTable">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Session Name</th>
                  <th>Start Date</th>
                  <th>End Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Teacher Assignments Section -->
        <div id="assign" class="content-section">
          <h2>Teacher Assignments</h2>

          <div class="form-card">
            <h3>Assign Teacher to Course</h3>
            <form id="assignTeacherForm">
              <div class="form-row">
                <div class="form-group">
                  <label>Teacher *</label>
                  <select name="teacherId" id="teacherSelect" required>
                    <option value="">Select Teacher</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Course *</label>
                  <select name="courseId" id="courseSelectTeacher" required>
                    <option value="">Select Course</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Section</label>
                  <select name="sectionId" id="sectionSelectTeacher">
                    <option value="">Select Section</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Session *</label>
                  <select name="sessionId" id="sessionSelectTeacher" required>
                    <option value="">Select Session</option>
                  </select>
                </div>
              </div>
              <button type="submit" class="btn-primary">Assign Teacher</button>
            </form>
          </div>

          <!-- Teacher Assignments Table -->
          <div class="table-card">
            <h3>Teacher Assignments</h3>
            <div class="search-bar">
              <input
                type="text"
                id="searchTeacherAssignments"
                placeholder="üîç Search assignments..."
                onkeyup="filterTableByBody('teacherAssignmentsTableBody', 'searchTeacherAssignments')"
              />
            </div>
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Teacher</th>
                  <th>Course</th>
                  <th>Section</th>
                  <th>Session</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="teacherAssignmentsTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- Student Enrollments Section -->
        <div id="enrollments" class="content-section">
          <div class="section-header">
            <h2>Student Enrollments</h2>
            <button class="btn-primary" onclick="loadEnrollmentData()">
              üîÑ Refresh
            </button>
          </div>

          <div class="form-card">
            <h3>Enroll Student in Course</h3>
            <form id="enrollStudentForm">
              <div class="form-row">
                <div class="form-group">
                  <label>Student *</label>
                  <select
                    name="studentId"
                    id="studentSelect"
                    required
                    onchange="updateCourseDropdownForStudent()"
                  >
                    <option value="">Select Student</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Course *</label>
                  <select name="courseId" id="courseSelectStudent" required>
                    <option value="">Select Course</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Section *</label>
                  <select
                    name="sectionId"
                    id="sectionSelectEnrollment"
                    required
                  >
                    <option value="">Select Section</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Session *</label>
                  <select
                    name="sessionId"
                    id="sessionSelectStudent"
                    required
                    onchange="updateCourseDropdownForStudent()"
                  >
                    <option value="">Select Session</option>
                  </select>
                </div>
              </div>
              <button type="submit" class="btn-primary">Enroll Student</button>
            </form>
          </div>

          <!-- Student Enrollments Table -->
          <div class="table-card">
            <h3>All Enrollments</h3>
            <div class="search-bar">
              <input
                type="text"
                id="searchEnrollments"
                placeholder="üîç Search enrollments..."
                onkeyup="filterEnrollments()"
              />
              <select
                id="filterEnrollmentCourse"
                onchange="filterEnrollments()"
                style="
                  margin-left: 10px;
                  padding: 10px;
                  border-radius: 5px;
                  border: 1px solid #ddd;
                  font-size: 14px;
                  min-width: 150px;
                "
              >
                <option value="">All Courses</option>
              </select>
              <select
                id="filterEnrollmentSection"
                onchange="filterEnrollments()"
                style="
                  margin-left: 10px;
                  padding: 10px;
                  border-radius: 5px;
                  border: 1px solid #ddd;
                  font-size: 14px;
                  min-width: 150px;
                "
              >
                <option value="">All Sections</option>
              </select>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Student Name</th>
                  <th>Roll Number</th>
                  <th>Course</th>
                  <th>Section</th>
                  <th>Session</th>
                  <th>Enrollment Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="enrollmentsTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- Attendance Section -->
        <div id="attendance" class="content-section">
          <h2>Attendance Records</h2>
          <div class="table-card" style="width: 100%">
            <div
              class="search-bar"
              id="attendanceFilters"
              style="margin-bottom: 15px"
            >
              <input
                type="text"
                id="searchAttendance"
                placeholder="üîç Search attendance..."
                onkeyup="filterAttendance()"
                style="flex: 1; padding: 10px"
              />
            </div>
            <table>
              <thead id="attendanceTableHeader" style="display: none">
                <tr>
                  <th>ID</th>
                  <th>Student</th>
                  <th>Roll Number</th>
                  <th>Course</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Marked At</th>
                  <th>Remarks</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="attendanceTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- Timetable Section -->
        <div id="timetable" class="content-section">
          <div class="section-header">
            <h2>Timetable Management</h2>
            <button class="btn-primary" onclick="showAddTimetableForm()">
              + Add Timetable Entry
            </button>
          </div>

          <div id="addTimetableForm" class="form-card" style="display: none">
            <h3>Add Timetable Entry</h3>
            <form id="createTimetableForm">
              <div class="form-row">
                <div class="form-group">
                  <label>Course *</label>
                  <select name="courseId" id="courseSelectTimetable" required>
                    <option value="">Select Course</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Teacher *</label>
                  <select name="teacherId" id="teacherSelectTimetable" required>
                    <option value="">Select Teacher</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Section</label>
                  <select name="sectionId" id="sectionSelectTimetable">
                    <option value="">Select Section</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Day of Week *</label>
                  <select name="dayOfWeek" required>
                    <option value="">Select Day</option>
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                    <option value="Saturday">Saturday</option>
                    <option value="Sunday">Sunday</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Start Time *</label>
                  <input type="time" name="startTime" required />
                </div>
                <div class="form-group">
                  <label>End Time *</label>
                  <input type="time" name="endTime" required />
                </div>
              </div>
              <div class="form-group">
                <label>Room Number</label>
                <input type="text" name="roomNumber" />
              </div>
              <div class="form-actions">
                <button type="submit" class="btn-primary">Add Entry</button>
                <button
                  type="button"
                  class="btn-secondary"
                  onclick="hideAddTimetableForm()"
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>

          <div class="table-card">
            <div class="search-bar">
              <input
                type="text"
                id="searchTimetable"
                placeholder="üîç Search timetable..."
                onkeyup="filterTableByBody('timetableTableBody', 'searchTimetable')"
              />
            </div>
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Course</th>
                  <th>Teacher</th>
                  <th>Section</th>
                  <th>Day</th>
                  <th>Start Time</th>
                  <th>End Time</th>
                  <th>Room</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="timetableTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="content-section">
          <div class="section-header">
            <div>
              <h2>üìä Attendance & System Reports</h2>
              <p
                style="
                  color: var(--text-secondary);
                  font-size: 1.1rem;
                  margin-top: 8px;
                "
              >
                Quick overview of your system's key statistics
              </p>
            </div>
          </div>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon blue"><i class="fas fa-users"></i></div>
              <div class="stat-info">
                <h3 id="totalUsers">0</h3>
                <p>Total Users</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon orange"><i class="fas fa-book"></i></div>
              <div class="stat-info">
                <h3 id="totalCourses">0</h3>
                <p>Total Courses</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon green">
                <i class="fas fa-calendar-check"></i>
              </div>
              <div class="stat-info">
                <h3 id="totalSessions">0</h3>
                <p>Total Sessions</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="js/admin-dashboard.js?v=hci2026"></script>
    <!-- Theme logic is now handled in admin-dashboard.js -->
  </body>
</html>
